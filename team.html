<?php
require_once __DIR__ . '/includes/cache.php';
cluedo_send_html_no_cache_headers();
?>
<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Cluedo - Ã‰quipe</title>
  <link rel="stylesheet" href="<?= htmlspecialchars(cluedo_asset_url('./css/style.css'), ENT_QUOTES, "UTF-8") ?>"/>
  <link rel="icon" href="<?= htmlspecialchars(cluedo_asset_url('./favicon.ico'), ENT_QUOTES, "UTF-8") ?>" type="image/x-icon"/>
  <script src="https://unpkg.com/html5-qrcode" defer></script>
  <script src="<?= htmlspecialchars(cluedo_asset_url('./js/photo-upload.js'), ENT_QUOTES, "UTF-8") ?>" defer></script>
  <script src="<?= htmlspecialchars(cluedo_asset_url('./js/team.js'), ENT_QUOTES, "UTF-8") ?>" defer></script>
</head>
<body>
  <div class="hub-app-version" data-app-version aria-label="Version applicative"></div>
  <main class="container team-page">
    <header class="card team-hero" aria-label="Nom de l'Ã©quipe">
      <p class="team-kicker">Espace Ã©quipe</p>
      <div class="team-hero-main">
        <h1 id="team-display-name" class="team-display-name">Ã‰quipe sans nom</h1>
        <button id="team-edit-name-btn" type="button" class="admin-button team-edit-name-btn" aria-label="Modifier le nom de l'Ã©quipe">âœï¸</button>
      </div>
      <p id="team-name-feedback" class="team-feedback"></p>
    </header>

    <section class="card team-guidance" aria-label="Guidage Ã©quipe">
      <h2 class="team-guidance-title">âœ… VÃ©rifications avant de jouer</h2>
      <p id="team-guidance-participants" class="team-guidance-message" role="status" aria-live="polite"></p>
      <p id="team-guidance-photo" class="team-guidance-message" role="status" aria-live="polite"></p>
    </section>

    <section class="card team-block team-qr-block" aria-label="Scanner QR code">
      <h2>ğŸ“± Scanner QR code</h2>
      <p class="team-feedback">Scannez puis ouvrez immÃ©diatement le lien du personnage.</p>
      <div class="team-qr-actions" aria-label="Actions de scan QR">
        <button id="team-qr-start-camera" type="button" class="admin-button team-qr-primary-btn">Scanner un QR code</button>
        <button id="team-qr-import-btn" type="button" class="admin-button team-qr-secondary-btn">Importer une image</button>
        <input id="team-qr-file-input" type="file" accept="image/*" class="team-qr-file-input"/>
      </div>
      <div id="team-qr-reader" aria-live="polite"></div>
      <p id="team-qr-feedback" class="team-feedback"></p>
    </section>

    <section class="team-accordion" aria-label="Sections de l'espace Ã©quipe">
      <article class="card team-block team-accordion-item" data-accordion-item>
        <h2 class="team-accordion-heading">
          <button type="button" class="team-accordion-trigger" data-accordion-trigger aria-expanded="false" aria-controls="team-accordion-panel-stats" id="team-accordion-trigger-stats">
            <span>ğŸ“Š RÃ©sumÃ© & Ã©tat du jeu <span class="team-accordion-hint">(appuyer pour ouvrir)</span></span>
            <span class="team-accordion-icon" aria-hidden="true">â–¾</span>
          </button>
        </h2>
        <div class="team-accordion-panel" id="team-accordion-panel-stats" role="region" aria-labelledby="team-accordion-trigger-stats" hidden>
          <h3>Personnages dÃ©jÃ  vus</h3>
          <div id="team-history">Chargementâ€¦</div>

          <h3>Ã‰tat global (actif / attente)</h3>
          <div id="team-global">Chargementâ€¦</div>
        </div>
      </article>

      <article class="card team-block team-accordion-item" data-accordion-item>
        <h2 class="team-accordion-heading">
          <button type="button" class="team-accordion-trigger" data-accordion-trigger aria-expanded="false" aria-controls="team-accordion-panel-participants" id="team-accordion-trigger-participants">
            <span>ğŸ‘¥ Participants <span class="team-accordion-hint">(appuyer pour ouvrir)</span></span>
            <span class="team-accordion-icon" aria-hidden="true">â–¾</span>
          </button>
        </h2>
        <div class="team-accordion-panel" id="team-accordion-panel-participants" role="region" aria-labelledby="team-accordion-trigger-participants" hidden>
          <form id="team-profile-form" class="team-form">
            <label class="admin-label" for="team-name">Nom de l'Ã©quipe</label>
            <input id="team-name" class="admin-input" maxlength="80" placeholder="Nom affichÃ©"/>
            <button type="submit" class="admin-button">Enregistrer le nom</button>

            <h3>Joueurs (max 10)</h3>
            <div id="team-players" class="team-players"></div>
            <button id="save-players" type="button" class="admin-button">Enregistrer</button>
          </form>
        </div>
      </article>

      <article class="card team-block team-accordion-item" data-accordion-item>
        <h2 class="team-accordion-heading">
          <button type="button" class="team-accordion-trigger" data-accordion-trigger aria-expanded="false" aria-controls="team-accordion-panel-photo" id="team-accordion-trigger-photo">
            <span>ğŸ“· Photo d'Ã©quipe <span class="team-accordion-hint">(appuyer pour ouvrir)</span></span>
            <span class="team-accordion-icon" aria-hidden="true">â–¾</span>
          </button>
        </h2>
        <div class="team-accordion-panel" id="team-accordion-panel-photo" role="region" aria-labelledby="team-accordion-trigger-photo" hidden>
          <div class="team-photo-wrap">
            <img id="team-photo" class="admin-photo team-photo-square" alt="Photo d'Ã©quipe"/>
            <input id="team-photo-input" type="file" accept="image/jpeg,image/png,image/webp"/>
            <p class="team-feedback">Image carrÃ©e + crop obligatoire. Envoi optimisÃ© pour mobile/iOS.</p>
          </div>
        </div>
      </article>
    </section>
  </main>
  <script src="<?= htmlspecialchars(cluedo_asset_url('./js/app-version.js'), ENT_QUOTES, "UTF-8") ?>" defer></script>
</body>
</html>
